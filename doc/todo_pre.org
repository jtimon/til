#+TITLE: Pre-Self-Hosting TODO List
#+AUTHOR: rstil Development
#+DATE: 2025-11-10

* Overview

This document tracks TODOs in the *Rust implementation (rstil)* that must be completed before the self-hosted til interpreter can run successfully.

*Current Status:* All documented bugs fixed (see [[file:bugs.org][bugs.org]]). Parser homogenization complete. Ready for next phase.

*Scope:* This focuses on rstil (Rust) implementation issues, NOT on completing the til-based interpreter/typer/etc.

* Progress Summary

| Component           | Status                          | Notes                                           |
|---------------------+---------------------------------+-------------------------------------------------|
| Known Bugs          | ✅ ALL FIXED                    | Bugs #1-#8 all resolved                        |
| Error Handling      | ✅ WORKING                      | throw/throws/catch fully functional             |
| Import System       | ✅ WORKING                      | Basic imports work in all modes                 |
| Test Suite          | ✅ PASSING                      | All tests pass including return value checks    |
| Type System         | ✅ COMPLETE                     | Return value usage enforced at compile time     |
| Parser Homogenization | ✅ COMPLETE                    | parser.til aligned with parser.rs              |

* Active TODOs

** TODO Improve Forward Reference Error Messages                         :MEDIUM:
:PROPERTIES:
:DISCOVERED: 2025-01-09
:IMPACT: Developer experience, debugging
:END:

*** Problem
When an enum references another enum that hasn't been defined yet (forward reference),
rstil gives an unclear error message at runtime instead of a clear parse-time error.

Example:
#+BEGIN_SRC til
ValueType := enum {
    TFunction: FunctionType,  // Forward reference - FunctionType not defined yet
}

FunctionType := enum {
    FTFunc,
    FTProc,
}
#+END_SRC

Current error (at runtime):
: get_enum: 'FunctionType' is not a custom enum type

Better error (at parse time):
: Forward reference: 'FunctionType' used in ValueType definition before being defined
: Hint: Move FunctionType definition before ValueType

*** What's Needed
- [ ] Add forward reference detection in parser.rs during enum definition parsing
- [ ] Provide clear error message with line numbers and helpful suggestion
- [ ] Document enum definition ordering requirements in language docs

*** Workaround
Manually ensure enum definitions are in dependency order (dependencies defined first).

* References

- [[file:bugs.org][bugs.org]] - Fixed bugs (Bugs #1-#8 all resolved)
- [[file:todo_self_hosting.org][todo_self_hosting.org]] - Component completion status
- [[file:todo_post.org][todo_post.org]] - Post self-hosting TODOs
- [[file:design_notes.org][design_notes.org]] - Language design decisions
- [[file:../src/tests.til][src/tests.til]] - Test suite (all tests passing)
- [[file:../src/test/todo.til][src/test/todo.til]] - Additional language TODOs

* Notes

** Focus on rstil, Not til Implementation
This document tracks what the *Rust interpreter (rstil)* needs to support self-hosting.

Completing interpreter.til, typer.til, etc. is a separate concern - those are the GOAL of self-hosting, not prerequisites.

** Workarounds Are Okay Temporarily
Some workarounds (like PatternInfo for tuples) are acceptable short-term. The priority is getting rstil stable enough to run the self-hosted code, even if that code has workarounds.
