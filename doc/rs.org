#+TITLE: Rust Rules for TIL Codebase

Short list of things NOT to do in Rust code for this project.

* Rules

** 1. Don't use panic!() directly
Use ~return Err(...)~ instead. TIL error handling is explicit.

** 2. Don't use variable shadowing
TIL doesn't support variable shadowing. Use different names instead.

Bad:
#+begin_src rust
let x = get_value();
let x = transform(x);  // shadows previous x
#+end_src

Good:
#+begin_src rust
let x = get_value();
let transformed_x = transform(x);  // different name
#+end_src

** 3. Don't use tuples, use structs
Tuples don't exist in TIL. Use named structs for straightforward translation.

Bad:
#+begin_src rust
fn get_bounds() -> (i64, i64) { (0, 100) }
let (min, max) = get_bounds();
#+end_src

Good:
#+begin_src rust
struct Bounds { min: i64, max: i64 }
fn get_bounds() -> Bounds { Bounds { min: 0, max: 100 } }
let bounds = get_bounds();
// use bounds.min, bounds.max
#+end_src

** 4. Avoid iterator chains, use for loops
Iterator chains like ~.iter().map().collect()~ are hard to translate to TIL.
Use explicit for loops instead.

Forbidden patterns:
- ~.iter().any()~ - use for loop with early ~return true~
- ~.iter().all()~ - use for loop with early ~return false~
- ~.iter().map().collect()~ - use for loop pushing to vec
- ~.iter().filter().collect()~ - use for loop with if
- ~.iter().find()~ - use for loop with early return
- ~.iter().position()~ - use for loop with index

Allowed patterns (translate directly):
- ~for (i, x) in items.iter().enumerate()~
- ~for x in &items~
- ~str.split('.').collect()~ - TIL has ~.split()~

* Potential Rules (to be discussed)

** Don't use expect() in library code
Reserve for truly impossible cases only. Prefer ~?~ with context.

** Don't use unsafe unless absolutely necessary
If you need unsafe, add a comment explaining why.

** Don't use clone() unless Rust requires it
TIL must match Rust's clone calls 1:1. Extra clones = memory bugs in TIL.

** Don't forget to port changes to TIL
After modifying src/rs/*.rs, update src/self/*.til to match.
Run ~make tests~ to verify both versions work.
