#+TITLE: Pre-Self-Hosting TODO List
#+AUTHOR: rstil Development
#+DATE: 2025-11-12

* Overview

This document tracks TODOs in the Rust implementation (rstil) that must be completed before the self-hosted til interpreter can run successfully.

Current Status: Core language features complete. Error handling standardized. One remaining API cleanup task.

Scope: This focuses on rstil (Rust) implementation issues, NOT on completing the til-based interpreter/typer/etc.

* TODO Active Items

- [ ] Implement pass-by-reference semantics with three argument modes
  - [X] Phase 1: Type checker immutability enforcement (COMPLETE)
    - Prevents assignment to immutable parameters (typer.rs:930, 937)
    - Prevents field modification of immutable parameters (check_assignment extracts root variable)
    - Prevents passing immutable to mut parameter (typer.rs:322-344)
    - Tests in src/test/tmp/test_immutability*.til verify all cases
  - [X] Phase 2: Add 'copy' keyword for explicit copy semantics (COMPLETE)
    - Added 'copy' token to lexer (lexer.rs:25, 208, 262)
    - Added is_copy field to Declaration and SymbolInfo (parser.rs:19, init.rs:22)
    - Parser validates 'copy' and 'mut' are mutually exclusive (parser.rs:536-546)
    - Type checker allows modification of copy parameters (typer.rs:930, 937)
    - Interpreter allows assignment to copy parameters (interpreter.rs:946, 953)
    - Comprehensive tests in src/test/args.til (lines 344-467)
    - All existing tests pass
  - [‚è∏] Phase 3: Use references for ALL non-copy parameters (DEFERRED)
    - Status: DEFERRED until after self-hosting
    - Reason: Added complexity without simplification, introduced subtle bugs
    - See: doc/bot/phase3_findings.org for detailed analysis
    - Decision: Phase 2 (copy keyword) already provides needed functionality
  - [ ] Phase 4: Update core library to remove Bug #24 workarounds (CAN DO NOW)
    - Remove copy-modify-reassign patterns from List.push(), List.set(), List.pop()
    - Verify other collections don't need similar fixes
    - Test simplified implementations
    - Mark Bug #24 as FIXED in bugs.org
  - Impact: Fixes Bug #24, cleaner semantics, better performance
  - See: doc/todo/plan_by_reference.org for detailed implementation plan

- [ ] Standardize len/cap API across collections
  - Current inconsistency: Array has len field, Vec has len+cap fields, Map has size field, Str has len() method
  - Goal: Consistent naming and access patterns across all collections

* Notes

Focus on rstil, Not til Implementation:
This tracks what the Rust interpreter (rstil) needs to support self-hosting.
Completing interpreter.til, typer.til, etc. is the GOAL of self-hosting, not prerequisites.

Workarounds Are Okay Temporarily:
Some workarounds are acceptable short-term. Priority is getting rstil stable enough to run the self-hosted code.
