#+TITLE: Post-Self-Hosting Features and Improvements
#+AUTHOR: TIL Development
#+DATE: 2026-01-29
# BOT: Issues use next number from doc/todo/next_issue_num.txt, then increment it.
# BOT: Add new issues at the top of Open Issues section.
# BOT: When implemented, move to Implemented Issues section at the bottom.
# BOT: Keep summary.org updated when adding/removing/moving issues.

* Overview

This document tracks features, improvements, and optimizations that can be
deferred until after self-hosting is achieved. These are not blocking the
self-hosted TIL interpreter but are planned for future development.

For bugs, see bugs.org. For language design decisions, see future.org.

* Open Issues

** Issue #155: Add Unicode support to TIL
:PROPERTIES:
:DISCOVERED: 2025-11-10
:IMPACT: Internationalization, modern text handling
:STATUS: Open
:FILE: src/rs/lexer.rs
:END:

*** Problem
TIL currently does not support Unicode characters in source code. The lexer
panics when encountering multi-byte UTF-8 characters like checkmarks, emoji,
or non-ASCII text.

Example error:
: byte index 368 is not a char boundary; it is inside '...' (bytes 367..370)

*** Current Limitation
Until Unicode is supported:
- NO Unicode characters should be used anywhere in the project
- This includes: source code, documentation files, comments, test files
- Use ASCII-only characters (e.g., [PASS] instead of checkmark)

*** What Needs to be Fixed
- Update lexer.rs to handle UTF-8 character boundaries correctly
- Use Rust's ~chars()~ iterator instead of byte indexing where appropriate
- Add comprehensive Unicode tests
- Update documentation about supported character sets

*** Implementation Notes
- Implement proper UTF-8 handling in lexer
- Add Unicode test suite
- Consider which Unicode features to support (identifiers, strings, etc.)
- Update lexer.til to match lexer.rs changes

*** Why Post-Self-Hosting
ASCII-only is sufficient for self-hosting. Unicode is a nice-to-have for
internationalization and modern text handling.

** Issue #154: Template vs Dynamic compilation mode
:PROPERTIES:
:DISCOVERED: 2026-01-29
:IMPACT: Binary size vs performance trade-off, embedded device support
:STATUS: Open
:RELATED: Issue #153 (Dynamic field/method access), Issue #111 (returns Dynamic)
:END:

*** Description
Currently TIL uses Dynamic internally for generic collections (Vec, Map, etc.) -
type erasure approach with one implementation that works for all types, checked
at runtime.

The vision: offer BOTH approaches via compiler flag, transparently to the user:
- ~--dynamic~ (or similar): Current behavior, type erasure, smaller binary
- ~--template~ (or similar): Rust-style monomorphization, specialized code per type

*** The Trade-off

| Mode     | Type checking | Binary size       | Performance |
|----------+---------------+-------------------+-------------|
| Dynamic  | Runtime       | Smaller (1 copy)  | Slower      |
| Template | Compile-time  | Larger (N copies) | Fast        |

*** User Experience
Same source code works either way:
#+BEGIN_SRC til
v := Vec.new(I64)
v.push(42)
#+END_SRC

With ~--dynamic~: One Vec implementation, runtime type info
With ~--template~: Specialized Vec_I64 generated, compile-time checks

The user doesn't change their code - the compiler flag decides.

*** Use Cases
- **Embedded devices**: Use ~--dynamic~ for limited flash, accept slower runtime
- **Performance-critical**: Use ~--template~ for speed, accept larger binary
- **Development**: Use ~--dynamic~ for fast compilation
- **Release**: Use ~--template~ for production performance

*** Why Post-Self-Hosting
This is a major compiler feature requiring:
- Template instantiation system
- Monomorphization pass
- Significant ccodegen changes
- Testing infrastructure for both modes

Current Dynamic-only approach works for self-hosting.

** Issue #152: Extract information from post_old.org
:PROPERTIES:
:DISCOVERED: 2026-01-29
:IMPACT: Documentation cleanup
:STATUS: Open
:END:

*** Description
The old post.org (now post_old.org) contains valuable TODOs and design notes
that need to be reviewed and migrated:

1. Items that are now DONE should be documented or removed
2. Items that duplicate future.org issues should be consolidated
3. Unique items should get proper issue numbers here or in future.org
4. Outdated information should be corrected or removed

*** Items to Review
- own keyword (DONE - see ownership.org)
- ? operator (designed - see errors.org)
- Closures/nested functions
- Namespace imports (may duplicate Issue #109)
- Macros (may duplicate Issue #88)
- Unicode support
- Operator overloading
- Various type system enhancements
- Mode system enhancements (safe_script, pure)
- Performance optimizations
- Error handling enhancements

*** After Extraction
Once all information is extracted and properly tracked, post_old.org can be
deleted.

* Implemented Issues

(None yet - move issues here when implemented)
