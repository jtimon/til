#+TITLE: Operating System Interface
#+AUTHOR: TIL Development
#+DATE: 2026-01-15
# BOT: Issues here use same numbering as bugs.org (from doc/todo/next_issue_num.txt)
# BOT: add them at the top of open issues, when implemented, move them to the top of implemented issues

* Overview

This document tracks operating system interface features - filesystem operations,
process management, environment access, and other OS-level functionality.

* Open Issues

** Issue #121: Directory traversal (readdir / walk)
:PROPERTIES:
:DISCOVERED: 2026-01-15
:IMPACT: Essential for file processing tools, build systems, code generators
:STATUS: Open
:END:

*** Description
Add functions to list directory contents and recursively traverse directory trees.
This is essential for writing tools that process multiple files.

*** Prior art

**** POSIX C (opendir/readdir/closedir)
#+BEGIN_SRC c
DIR *dir = opendir("src/");
struct dirent *entry;
while ((entry = readdir(dir)) != NULL) {
    printf("%s\n", entry->d_name);
}
closedir(dir);
#+END_SRC

**** Python os.walk
#+BEGIN_SRC python
for root, dirs, files in os.walk("src/"):
    for file in files:
        print(os.path.join(root, file))
#+END_SRC

**** Tsoding's C implementation
Reference: Tsoding's recent video on implementing directory traversal in C
using the POSIX API. Shows practical patterns for recursive traversal with
proper error handling.

*** Proposed API (TBD)
#+BEGIN_SRC til
// Option 1: Low-level POSIX-style
DirEntry := struct {
    mut name: Str = ""
    mut is_dir: Bool = false
}

readdir := ext_proc(path: Str) returns Vec throws IOError {
    // Returns Vec of DirEntry
}

// Option 2: Higher-level walk function
walk := proc(path: Str, callback: proc(Str)) throws IOError {
    // Recursively visits all files, calls callback with each path
}

// Option 3: Iterator-based (if TIL gets iterators)
walk_iter := proc(path: Str) returns DirIterator throws IOError {
    // Returns iterator over all files
}
#+END_SRC

*** Implementation notes
- Need ext_proc wrapping POSIX opendir/readdir/closedir
- Must handle . and .. entries (skip them)
- Need is_dir check (stat or d_type)
- Consider symlink handling
- Error handling for permission denied, not found, etc.

*** Use cases
- Build systems processing source files
- Code generators finding all .til files
- Test runners discovering test files
- Refactoring tools updating multiple files

* Implemented Issues

