mode test

// C codegen tests

import("src.self.builder")

// Test 1: Rust codegen via rstil command - core.til
test_rs_ccodegen := proc() {
    _ := run_cmd("./bin/rstil", "build", "src/core/core.til")
}
test_rs_ccodegen()

// Test 2: Rust codegen via rstil command - hello_script.til
test_rs_ccodegen_hello := proc() {
    // TODO: "run" causes segfault in compiled hello_script - investigate
    _ := run_cmd("./bin/rstil", "build", "src/test/hello/hello_script.til")
    // assert_eq_str(loc(), "Hello World!\n", output)
}
test_rs_ccodegen_hello()

// Test 3: TIL codegen via self-hosted builder
test_til_ccodegen := proc() {
    _ := build("src/core/core.til")

    catch (err: Str) {
        panic(loc(), format("TIL C codegen test failed: ", err))
    }
}
// TODO: TIL self-hosted ccodegen times out - either infinite loop or just too slow (interpreted)
// test_til_ccodegen()
