mode lib

import("test.cross_file_forward.component")

/** Entity that contains Components - but Component also references Entity */
Entity := struct {
    mut id: I64 = 0
    mut name: Str = ""
    mut components: Vec = Vec()  // Will hold Component instances

namespace:
    new : proc(id: I64, name: Str) returns Entity = {
        mut e := Entity()
        e.id = id
        e.name = name
        e.components = Vec.new(Component)
        return e
    }

    add_component : proc(mut self: Entity, comp: Component) = {
        self.components.push(comp)
    }

    get_component : proc(self: Entity, index: I64) returns Component throws IndexOutOfBoundsError = {
        comp := cast(Component, self.components.get(index)?)
        // TODO Bug #177: clone needed because ccodegen skips *_ret for cast returns
        return comp.clone()
    }
}
