mode test

// Test that the bang operator (!) panics when a function throws.
// This is the TIL equivalent of Rust's .unwrap().
//
// Expected behavior: might_fail throws MyError, the desugared catch block
// from ! calls panic(), and the process exits with status 1.

MyError := struct {
    mut msg: Str = "something went wrong"
}

RangeError := struct {
    mut msg: Str = "out of range"
}

might_fail := func(x: I64) returns I64 throws MyError {
    if x.eq(0) {
        throw MyError(msg="cannot handle zero")
    }
    return x
}

// Multiple throw types: desugarer must generate catch blocks for both
might_fail_multi := func(x: I64) returns I64 throws MyError, RangeError {
    if x.eq(0) {
        throw MyError(msg="cannot handle zero")
    }
    if x.lt(0) {
        throw RangeError(msg="negative not allowed")
    }
    return x
}

// This should panic because might_fail_multi(-1) throws RangeError,
// and ! desugars to catch blocks for both MyError and RangeError
result := might_fail_multi(sub(0, 1))!
