mode test

Vec2 := struct {
    mut x : I64 = 0
    mut y : I64 = 0
}

modify_vec := proc(mut v: Vec2) {
    v.x = 100
    v.y = 200
}

test_mut_struct := proc() {
    mut v := Vec2()
    v.x = 1
    v.y = 2

    assert_eq(loc(), 1, v.x)
    assert_eq(loc(), 2, v.y)

    modify_vec(v)

    assert_eq(loc(), 100, v.x)
    assert_eq(loc(), 200, v.y)
}

test_mut_struct()

test_mut_array := proc() {
    mut arr := Vec.new("I64", size_of(I64))

    assert_eq(loc(), 0, arr.len)
    assert_eq(loc(), 16, arr.cap)

    arr.push(10)

    assert_eq(loc(), 1, arr.len)

    mut value := 0
    arr.get(0, value)

    assert_eq(loc(), 10, value)

    arr.delete()

    // Catch unexpected errors at end
    catch (err: AllocError) {
        println("ERROR:", loc(), "Unexpected AllocError")
        println(err.msg)
        exit(1)
    }
    catch (err: FullError) {
        println("ERROR:", loc(), "Unexpected FullError")
        println(err.msg)
        exit(1)
    }
    catch (err: IndexOutOfBoundsError) {
        println("ERROR:", loc(), "Unexpected IndexOutOfBoundsError")
        println(err.msg)
        exit(1)
    }
}

test_mut_array()

test_const_to_const := proc() {
    read := proc(v: Vec2) {
        assert_eq(loc(), 0, v.x)
        assert_eq(loc(), 0, v.y)
    }
    v := Vec2()
    read(v)
}

test_const_to_const()
